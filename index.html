<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>GENÃ‡ GROSS â€¢ Mobil Terminal â€” Barkod + Adet â†’ TXT</title>
  <meta name="theme-color" content="#1C2AAE"/>
  <link rel="manifest" href="manifest.json">
  <style>
    :root{
      --blue:#1C2AAE;--orange:#F0552C;--ok:#1fbf75;--warn:#ff5d5d;
      --bg:#0f172a;--card:#0b1226;--text:#e6ecff;--muted:#9db1ff35;
      --line:#22326b
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text)}
    header{background:linear-gradient(90deg,var(--orange),var(--blue));padding:14px 12px}
    header .wrap{max-width:980px;margin:auto;display:flex;justify-content:space-between;align-items:center}
    header .ttl{font-weight:800}
    .wrap{max-width:980px;margin:auto;padding:12px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;margin:10px 0;box-shadow:0 6px 20px #0003}
    .row{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
    label{font-size:13px;opacity:.9}
    input,select,button{border-radius:10px;border:1px solid var(--line);padding:9px 12px;background:#0f1832;color:var(--text)}
    input[type="file"]{padding:7px}
    input::placeholder{color:#9fb0ff80}
    button{cursor:pointer;font-weight:700}
    .primary{background:var(--blue);border-color:#2b3bc3}
    .accent{background:var(--orange);border-color:#ff6a4a}
    .good{background:var(--ok);border-color:#14a862}
    .warn{background:var(--warn);border-color:#ff6b6b}
    .chip{display:inline-block;background:#11235a;border:1px solid var(--line);padding:3px 8px;border-radius:999px;font-size:12px;margin-right:6px;opacity:.9}
    .videoBox{position:relative;border-radius:12px;overflow:hidden;background:#000}
    video{display:block;width:100%;max-height:320px}
    .roi{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none}
    .roi:after{content:"";width:68%;height:32%;border:2px solid rgba(255,255,255,.88);border-radius:10px;box-shadow:0 0 0 200vmax rgba(0,0,0,.35) inset}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{border-bottom:1px solid var(--line);padding:8px}
    th{background:#0f1832}
    .right{text-align:right}
    .muted{opacity:.8;font-size:13px}
    .ok{color:#39d98a}.bad{color:#ff6b6b}
    .pill{display:inline-block;padding:2px 7px;border-radius:999px;border:1px solid var(--line);background:#0f1832;font-size:12px}
    .searchItem{padding:10px;border:1px solid var(--line);border-radius:12px;background:#0e1730;margin-top:8px}
    .searchItem strong{display:block}
    .click{cursor:pointer}
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="ttl">GENÃ‡ GROSS â€¢ Mobil Terminal</div>
    <div>Barkod + Adet â†’ TXT</div>
  </div>
</header>

<div class="wrap">

  <!-- Kamera -->
  <div class="card">
    <div class="row">
      <label>Kamera:</label>
      <select id="cameraSelect"></select>
      <button id="btnStart" class="primary">KamerayÄ± BaÅŸlat</button>
      <button id="btnStop">Durdur</button>
      <button id="btnScanOnce" class="accent" style="margin-left:auto">ðŸ‘‰ Tek Okut</button>
    </div>
    <div class="videoBox">
      <video id="video" playsinline autoplay muted></video>
      <div class="roi"></div>
    </div>
    <div class="row" style="margin-top:6px">
      <span id="scanStatus" class="chip">HazÄ±r</span>
      <span id="fps" class="chip">FPS: -</span>
      <span class="chip">Ä°pucu: Barkodu kutunun iÃ§inde, 15â€“25 cm mesafe; iyi Ä±ÅŸÄ±k.</span>
    </div>
  </div>

  <!-- GiriÅŸ + Liste -->
  <div class="card">
    <label>Barkod / Kod & Adet</label>
    <div class="row">
      <input id="barcode" type="tel" inputmode="numeric" pattern="[0-9]*"
             autocomplete="off" placeholder="Barkod veya Stok Kodu" style="flex:1;min-width:220px"/>
      <button id="btnOk" class="accent">Tamam</button>
      <button id="btnFieldClear">Temizle</button>
    </div>

    <div class="row">
      <button id="btnMinus">-1</button>
      <input id="qty" type="number" value="1" min="1" step="1" style="width:90px;text-align:center"/>
      <button id="btnPlus">+1</button>
      <button id="btnAdd" class="good">Ekle</button>
      <button id="btnUndo">Geri Al</button>
    </div>

    <div class="muted" style="margin-top:6px">
      ÃœrÃ¼n: <span id="pname" class="ok">â€”</span> Â· Fiyat: <span id="pprice" class="pill">â€”</span>
    </div>

    <div class="row" style="margin-top:10px">
      <label>Dosya AdÄ±:</label>
      <input id="filename" placeholder="sayim" style="width:220px"/>
      <button id="btnExport" class="primary">TXT Olarak DÄ±ÅŸa Aktar</button>
      <button id="btnCSV" class="accent">CSV Olarak DÄ±ÅŸa Aktar</button>
      <button id="btnClear" class="warn" style="margin-left:auto">Listeyi Temizle</button>
    </div>

    <table>
      <thead><tr><th>Barkod</th><th>Ä°sim</th><th class="right">Adet</th><th></th></tr></thead>
      <tbody id="tbody"></tbody>
    </table>
    Toplam satÄ±r: <span id="totalRows">0</span> Â· Toplam adet: <span id="totalQty">0</span>
  </div>

  <!-- ÃœrÃ¼n dosyasÄ± -->
  <div class="card">
    <h3 style="margin:0 0 6px 0">ÃœrÃ¼n Verisi YÃ¼kle</h3>
    <div class="muted">CSV/TXT (Ã¶r. <code>kod;isim;â€¦;fiyat</code>) veya JSON/GNCPULUF yÃ¼kleyebilirsin. YÃ¼klendikten sonra veri cihazda saklanÄ±r; sayfayÄ± yenilesen de kalÄ±r.</div>
    <div class="row" style="margin-top:8px">
      <input id="productFile" type="file" accept=".txt,.csv,.json,.gdf,.gtf,.gncpuluf"/>
      <select id="encSel" title="Dosya kodlamasÄ±">
        <option value="windows-1254">TÃ¼rkÃ§e (Windows-1254)</option>
        <option value="utf-8">UTF-8</option>
        <option value="iso-8859-9">ISO-8859-9</option>
      </select>
      <button id="btnClearMap" class="warn">ÃœrÃ¼n Verisini Temizle</button>
      <span class="chip" id="mapStat">0 Ã¼rÃ¼n yÃ¼klÃ¼</span>
    </div>
  </div>

  <!-- Arama -->
  <div class="card">
    <h3 style="margin:0 0 8px 0">ÃœrÃ¼n Arama (isimle)</h3>
    <input id="search" placeholder="Ã¶rn: onurlu, ekmek, kolonya..." autocomplete="off"/>
    <div id="searchList"></div>
    <div class="muted">SonuÃ§lara dokunun: barkodu kopyalar ve Ã¼st giriÅŸe doldurur.</div>
  </div>

  <audio id="okSound" src="beep.ogg" preload="auto"></audio>
  <audio id="errSound" src="error.ogg" preload="auto"></audio>

</div>

<script src="app.js"></script>
<script>
  if('serviceWorker' in navigator){
    window.addEventListener('load',()=>navigator.serviceWorker.register('sw.js'));
  }
</script>
</body>
</html>
